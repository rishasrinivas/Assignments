<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bioinformatics Network Visualization - Protein-Protein Interactions</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-group {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        select, input[type="range"] {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            color: white;
        }
        
        select option {
            background: #333;
            color: white;
        }
        
        #network-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #FFD700;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }
        
        .node {
            cursor: pointer;
            stroke-width: 2px;
        }
        
        .link {
            stroke-opacity: 0.6;
        }
        
        .node-label {
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            pointer-events: none;
            fill: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§¬ Bioinformatics Network Visualization</h1>
        <p class="subtitle">Dopamine-Related Protein-Protein Interaction Network</p>
        
        <div class="controls">
            <div class="control-group">
                <label>Filter by Type:</label>
                <select id="protein-filter">
                    <option value="all">All Proteins</option>
                    <option value="GPCR">GPCR</option>
                    <option value="Enzyme">Enzyme</option>
                    <option value="Growth Factor">Growth Factor</option>
                    <option value="G-protein">G-protein</option>
                    <option value="Transporter">Transporter</option>
                    <option value="Regulatory">Regulatory</option>
                </select>
            </div>
            <div class="control-group">
                <label>Link Strength:</label>
                <input type="range" id="link-strength" min="0.5" max="1.0" step="0.1" value="0.7">
                <span id="strength-value">0.7</span>
            </div>
            <div class="control-group">
                <label>Node Size:</label>
                <select id="size-metric">
                    <option value="degree_centrality">Degree Centrality</option>
                    <option value="betweenness_centrality">Betweenness Centrality</option>
                    <option value="molecular_weight">Molecular Weight</option>
                </select>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ff6b6b;"></div>
                <span>GPCR</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4ecdc4;"></div>
                <span>Enzyme</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #45b7d1;"></div>
                <span>Growth Factor</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f9ca24;"></div>
                <span>G-protein</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #6c5ce7;"></div>
                <span>Transporter</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #a0522d;"></div>
                <span>Regulatory</span>
            </div>
        </div>
        
        <div id="network-container"></div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="node-count">11</div>
                <div>Total Proteins</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="edge-count">22</div>
                <div>Interactions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-score">0.812</div>
                <div>Avg. Interaction Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="max-centrality">DRD4</div>
                <div>Most Central Protein</div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Network data
        const nodes = [
            {id: "BDNF", name: "Brain-derived neurotrophic factor", type: "Growth Factor", pathway: "Neurotrophin signaling", expression: "High", weight: 27.0, location: "Extracellular", degree: 0.4, betweenness: 0.1, closeness: 0.6, eigenvector: 0.3},
            {id: "COMT", name: "Catechol O-methyltransferase", type: "Enzyme", pathway: "Dopamine metabolism", expression: "Medium", weight: 30.0, location: "Cytoplasm", degree: 0.5, betweenness: 0.2, closeness: 0.7, eigenvector: 0.4},
            {id: "DRD2", name: "Dopamine receptor D2", type: "GPCR", pathway: "Dopamine signaling", expression: "High", weight: 50.4, location: "Membrane", degree: 0.6, betweenness: 0.3, closeness: 0.8, eigenvector: 0.6},
            {id: "DRD3", name: "Dopamine receptor D3", type: "GPCR", pathway: "Dopamine signaling", expression: "Medium", weight: 52.1, location: "Membrane", degree: 0.5, betweenness: 0.2, closeness: 0.7, eigenvector: 0.5},
            {id: "DRD4", name: "Dopamine receptor D4", type: "GPCR", pathway: "Dopamine signaling", expression: "Low", weight: 48.9, location: "Membrane", degree: 0.8, betweenness: 0.4, closeness: 0.9, eigenvector: 0.8},
            {id: "GNAI1", name: "G protein alpha inhibiting 1", type: "G-protein", pathway: "GPCR signaling", expression: "High", weight: 40.3, location: "Membrane", degree: 0.4, betweenness: 0.1, closeness: 0.6, eigenvector: 0.4},
            {id: "GNB3", name: "G protein beta 3", type: "G-protein", pathway: "GPCR signaling", expression: "Medium", weight: 37.0, location: "Membrane", degree: 0.2, betweenness: 0.0, closeness: 0.5, eigenvector: 0.2},
            {id: "MAOA", name: "Monoamine oxidase A", type: "Enzyme", pathway: "Neurotransmitter metabolism", expression: "High", weight: 59.7, location: "Mitochondria", degree: 0.3, betweenness: 0.1, closeness: 0.6, eigenvector: 0.3},
            {id: "SLC6A3", name: "Dopamine transporter", type: "Transporter", pathway: "Dopamine reuptake", expression: "High", weight: 68.5, location: "Membrane", degree: 0.3, betweenness: 0.1, closeness: 0.6, eigenvector: 0.3},
            {id: "SLC6A4", name: "Serotonin transporter", type: "Transporter", pathway: "Serotonin reuptake", expression: "Medium", weight: 70.3, location: "Membrane", degree: 0.3, betweenness: 0.1, closeness: 0.6, eigenvector: 0.3},
            {id: "KLHL12", name: "Kelch-like protein 12", type: "Regulatory", pathway: "Protein degradation", expression: "Low", weight: 69.2, location: "Cytoplasm", degree: 0.1, betweenness: 0.0, closeness: 0.4, eigenvector: 0.1}
        ];

        const links = [
            {source: "BDNF", target: "COMT", score: 0.919, type: "protein_binding"},
            {source: "BDNF", target: "DRD2", score: 0.790, type: "protein_binding"},
            {source: "BDNF", target: "DRD3", score: 0.841, type: "protein_binding"},
            {source: "BDNF", target: "DRD4", score: 0.856, type: "protein_binding"},
            {source: "COMT", target: "DRD2", score: 0.743, type: "enzymatic_regulation"},
            {source: "COMT", target: "DRD3", score: 0.698, type: "enzymatic_regulation"},
            {source: "COMT", target: "DRD4", score: 0.712, type: "enzymatic_regulation"},
            {source: "COMT", target: "MAOA", score: 0.892, type: "enzymatic_pathway"},
            {source: "DRD2", target: "DRD3", score: 0.934, type: "receptor_family"},
            {source: "DRD2", target: "DRD4", score: 0.887, type: "receptor_family"},
            {source: "DRD2", target: "GNAI1", score: 0.823, type: "gprotein_coupling"},
            {source: "DRD2", target: "GNB3", score: 0.756, type: "gprotein_coupling"},
            {source: "DRD3", target: "DRD4", score: 0.901, type: "receptor_family"},
            {source: "DRD3", target: "GNAI1", score: 0.798, type: "gprotein_coupling"},
            {source: "DRD4", target: "GNAI1", score: 0.812, type: "gprotein_coupling"},
            {source: "DRD4", target: "SLC6A3", score: 0.734, type: "neurotransmitter_system"},
            {source: "DRD4", target: "SLC6A4", score: 0.689, type: "neurotransmitter_system"},
            {source: "GNAI1", target: "GNB3", score: 0.967, type: "gprotein_complex"},
            {source: "MAOA", target: "SLC6A3", score: 0.845, type: "neurotransmitter_metabolism"},
            {source: "MAOA", target: "SLC6A4", score: 0.798, type: "neurotransmitter_metabolism"},
            {source: "SLC6A3", target: "SLC6A4", score: 0.823, type: "transporter_family"},
            {source: "KLHL12", target: "DRD4", score: 0.654, type: "protein_regulation"}
        ];

        // Color mapping for protein types
        const colorMap = {
            "GPCR": "#ff6b6b",
            "Enzyme": "#4ecdc4",
            "Growth Factor": "#45b7d1",
            "G-protein": "#f9ca24",
            "Transporter": "#6c5ce7",
            "Regulatory": "#a0522d"
        };

        // Set up SVG
        const width = 1000;
        const height = 600;
        const svg = d3.select("#network-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Create tooltip
        const tooltip = d3.select("#tooltip");

        // Initialize simulation
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(d => 100 * (1 - d.score)))
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(d => getNodeSize(d) + 5));

        // Create links
        const link = svg.append("g")
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("class", "link")
            .attr("stroke", "#999")
            .attr("stroke-width", d => Math.sqrt(d.score * 10));

        // Create nodes
        const node = svg.append("g")
            .selectAll("circle")
            .data(nodes)
            .join("circle")
            .attr("class", "node")
            .attr("r", getNodeSize)
            .attr("fill", d => colorMap[d.type])
            .attr("stroke", "#fff")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // Create labels
        const labels = svg.append("g")
            .selectAll("text")
            .data(nodes)
            .join("text")
            .attr("class", "node-label")
            .text(d => d.id)
            .attr("dy", d => getNodeSize(d) + 15);

        // Add interactivity
        node.on("mouseover", function(event, d) {
            tooltip.style("opacity", 1)
                .html(`
                    <strong>${d.name}</strong><br/>
                    Type: ${d.type}<br/>
                    Pathway: ${d.pathway}<br/>
                    Expression: ${d.expression}<br/>
                    Location: ${d.location}<br/>
                    Molecular Weight: ${d.weight} kDa<br/>
                    Degree Centrality: ${d.degree.toFixed(3)}<br/>
                    Betweenness: ${d.betweenness.toFixed(3)}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        })
        .on("mouseout", function() {
            tooltip.style("opacity", 0);
        });

        // Update positions on simulation tick
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);

            labels
                .attr("x", d => d.x)
                .attr("y", d => d.y);
        });

        // Helper functions
        function getNodeSize(d) {
            const metric = document.getElementById("size-metric").value;
            const baseSize = 10;
            const scaleFactor = 30;
            return baseSize + (d[metric] || d.degree) * scaleFactor;
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Control event listeners
        document.getElementById("protein-filter").addEventListener("change", function() {
            const filterValue = this.value;
            node.style("opacity", d => filterValue === "all" || d.type === filterValue ? 1 : 0.2);
            labels.style("opacity", d => filterValue === "all" || d.type === filterValue ? 1 : 0.2);
        });

        document.getElementById("link-strength").addEventListener("input", function() {
            const strength = parseFloat(this.value);
            document.getElementById("strength-value").textContent = strength;
            link.style("opacity", d => d.score >= strength ? 0.6 : 0.1);
        });

        document.getElementById("size-metric").addEventListener("change", function() {
            node.transition().duration(500).attr("r", getNodeSize);
            labels.transition().duration(500).attr("dy", d => getNodeSize(d) + 15);
        });

        console.log("Network visualization loaded successfully!");
    </script>
</body>
</html>
<script>
    window.__lindy_frame_handlers_initialized ||= (() => {
        window.addEventListener('message', (event) => {
            if (event.data.type === 'navigate') {
                const { path } = event.data

                const url = new URL(path, window.location.origin)

                window.location.href = url.toString()
            } else if (event.data.type === 'navigate-back') {
                window.history.back()
            } else if (event.data.type === 'navigate-forward') {
                window.history.forward()
            } else if (event.data.type === 'reload') {
                window.location.reload()
            }
        })

        let currentHistoryIndex = window.history.length - 1

        function sendNavigationState() {
            window.parent.postMessage({
                type: 'navigation-state',
                state: {
                    canGoBack: currentHistoryIndex > 0,
                    canGoForward: currentHistoryIndex < window.history.length - 1,
                    path: window.location.pathname,
                    href: window.location.href,
                    title: document.title,
                },
            }, '*')
        }

        function watchForNavigationChange(currentPath, attempts = 0) {
            if (attempts > 10) {
                return
            }

            if (window.location.pathname === currentPath) {
                setTimeout(() => watchForNavigationChange(currentPath, attempts + 1), 100)
            } else {
                sendNavigationState()
            }
        }

        window.addEventListener('popstate', () => {
            currentHistoryIndex--
            sendNavigationState()
        })

        window.history.pushState = new Proxy(window.history.pushState, {
            apply: (target, thisArg, argArray) => {
                currentHistoryIndex = window.history.length
                watchForNavigationChange(window.location.pathname)
                return target.apply(thisArg, argArray)
            },
        })

        window.history.replaceState = new Proxy(window.history.replaceState, {
            apply: (target, thisArg, argArray) => {
                currentHistoryIndex = window.history.length
                watchForNavigationChange(window.location.pathname)
                return target.apply(thisArg, argArray)
            },
        })

        function sendPageLoaded() {
            window.parent.postMessage({
                type: 'page-loaded',
            }, '*')
        }

        if (document.readyState === 'complete') {
            sendPageLoaded()
        } else {
            window.addEventListener('load', sendPageLoaded)
        }

        sendNavigationState()

        return true
    })()
</script>
